---
import { getBlogDetail, getBlogs } from "../../lib/microcms";
import { formatDateJST } from "../../utils/date/formatDateJST";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { Image } from "astro:assets";

export async function getStaticPaths() {
  const { contents } = await getBlogs();
  return contents.map((blog) => ({
    params: { id: blog.id },
    props: { blog },
  }));
}

const { id } = Astro.params;
const blog = await getBlogDetail(id!);
---

<BaseLayout title={blog.title}>
  <div class="mainContentInner">
    <div class="header">
      <h1 class="title">{blog.title}</h1>
      <p class="date">{formatDateJST(blog.publishedAt)}</p>
      {
        blog.eyecatch && (
          <div class="image">
            <Image
              src={`${blog.eyecatch.url}?fm=webp`}
              alt={blog.title}
              width={blog.eyecatch.width}
              height={blog.eyecatch.height}
              format="webp"
            />
          </div>
        )
      }
    </div>
    <div class="content" set:html={blog.content} />
    <nav class="breadcrumb">
      <a href="/">← 記事一覧に戻る</a>
    </nav>
  </div>
</BaseLayout>

<style>
  .mainContentInner {
    max-width: 820px;
    display: block grid;
    gap: var(--spacing-8);
  }
</style>

<style is:global>
  .breadcrumb {
    text-align: center;
  }

  .breadcrumb a {
    color: var(--bunker);
    text-decoration: none;
    font-size: var(--font-size-small);
    transition: color 0.2s ease;
    border-bottom: var(--is-hover-true, 1px solid var(--bunker))
            var(--is-hover-false, none);
  }

  .header {
    display: block grid;
    gap: var(--spacing-3);
  }

  .title {
    font-size: var(--font-size-h2);
    line-height: 1.2;
  }

  .date {
    font-size: var(--font-size-small);
    color: var(--scarpa-flow);
  }

  .image img {
    width: 100%;
    height: auto;
  }

  .content {
    line-height: 1.8;
  }

  .content h2 {
    font-size: var(--font-size-h3);
    margin-block-start: 5.4rem;
  }

  .content h3 {
    font-size: var(--font-size-large);
    margin-block-start: 3.6rem;
  }

  .content h3 {
    font-size: var(--font-size-large);
    margin-block-start: 1.33rem;
  }

  .content p {
    margin-block-end: var(--spacing-3);
    margin: 1.8rem 0;
  }

  .content img {
    max-width: 100%;
    height: auto;
    margin: var(--spacing-4) 0;
  }

  .content > *:first-child {
    margin-block-start: 0;
  }

  .content > *:last-child {
    margin-block-end: 0;
  }
</style>
